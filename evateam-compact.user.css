/* ==UserStyle==
@name           EvaTeam compact
@namespace      github.com/openstyles/stylus
@version        1.0.0
@description    Compact interface for EvaTeam.ru (JIRA competitor)
@author         Pavel Alexeev <Pahan@Hubbitus.info>
==/UserStyle== */

@-moz-document regexp("^https?://eva[-\\d\\w]*\\..*") {
	/**
	* Main URLs to check against:
	* - https://eva.gid.team/project/Roadmap/RM-000059#rabota-komandy-po-proektu-mrg
	* - https://eva.gid.team/project/Task/DEVOPS-8327#grafana-dovesti-do-sostojanija-prigodnogo-dlja-raboty
	* - https://eva.gid.team/project/Roadmap/RM-000059?obj=Task:GIDMRG-155#razrabotka-poyasnitelnoj-zapiski-tehnicheskogo-proekta - popup task view
	* - https://eva.gid.team/project/Registry/RGS-000511#trebovanija requirements
	* - https://eva.gid.team/project/Document/DOC-000059#dokumenty documents main
	* - https://eva.gid.team/project/Document/DOC-028499#vitrina-datanova-datamart-fct-datanova document example
	**/

	[_nghost-ng-c2048061549] {
		--node-min-height: 20px !important;
		--tree-margin-top: 0 !important;
		--new-mode-tree-node-padding-left: 0 !important;
		--nested-nodes-first-level-padding-left: 29px !important;
		--node-settings-margin: 0 !important;
		--nested-nodes-name-item-margin: 0 !important;

		--default-line-height: 20px !important;
	}

	/** Top header **/
	.project-content {
		padding: 0 !important;
		margin: 0 !important;
	}

	mat-drawer, header.main__menu {
		height: 32px !important; /*???*/
	}
	mat-drawer.drawer-header {
		z-index: 90;
	}
	mat-drawer-content.drawer-container, .drawer-container .drawer-content.displaced 	 {
		height: 100%;
	}
	mat-drawer-content.mat-drawer-content {
		z-index: 100;
	}
	.drawer-container .drawer-content.displaced {
		margin-top: 32px !important;
		height: calc(100vh - 32px) !important;
	}
	.page__navigate { /* project name */
		top: 1px;
		left: 750px;
		background: lightgoldenrodyellow;
		z-index: 120;
		opacity: 0.8;
		width: auto !important;
		height: 29px;
		border-radius: 5px;
	}
	.page__navigate .hamburger, .page__navigate .hamburger app-cmf-navigate-panel, .page__navigate .hamburger .navigate__selected__item {
		margin: 0 !important;
		padding: 0 !important;
	}

	.toolbar {
		position: initial;
		right: 0;
		width: 100% !important;
		margin-top: -5px;
		padding: 0px 10px 5px 10px;
		z-index: 100;
		/* background: #a3a8a32e; */
	}
	.toolbar .left {
		z-index: 50;
		margin-top: -3px;
		width: fit-content;
		padding-right: 0px;
		height: 32px;
	}
	.toolbar .toolbar__right {
		right: 33px !important;
		top: -6px !important;
	}
	#task-popup-dialog .toolbar__right {
		right: 15px !important;
		top: 6px !important;
	}
	.gantt__layout {
		height: calc(100% - 22px);
	}
	.gantt__header {
		margin-top: -3px !important;
	}
	.gantt__layout__tree, .gantt__layout__chart, .resize-controller-x-gantt {
		height: calc(100% + 45px);
	}
	.mat-icon-button {
		line-height: 36px;
	}

	body:has(.gantt) .project-module {
		margin-top: -26px;
	}
	.project-module.displaced, .wrapper__left.displaced, .wrapper__right.displaced, .project-module .mat-sidenav-content.displaced {
	/*	height: calc(100vh - 3px) !important; Break layout on requirements! */
	}
	#section-to-print, .project-module, .mat-drawer-content, .wrapper__left {
		height: 100% !important;
	}
	.scrollable-block {
		height: 100% !important;
	}
	/** /Top header **/

	/** Tree of docs at left **/
	/* Tree of docs at left: Break long doc names in left tree */
	.cmf-tree .overflow-ellipsis .node-name-item > span {
		white-space: break-spaces;
		line-height: 0.9;
	}
	/* Tree of docs at left: list items */
	.sub__menu {
		top: 0 !important;
		height: calc(100vh - 29px) !important;
		/* overflow: auto; /* scrollbars at left. TODO break mouse resizing */
		scrollbar-width: thin;
	}
	/* Compact chapters */
	.project-module-sidenav.displaced, #tree-scroll-container {
		height: calc(100vh - 85px) !important;
	}
	.cmf-tree-container.new-mode {
		padding-top: 0 !important;
	}
	.node-settings { /* node 3 dots right menu */
		margin: 0 0 0 0px !important;
	}
	.confluence-tree-footer {
		margin-top: 0 !important;
	}

	/* show list bullets */
	.cmf-tree-container mat-nested-tree-node .nested-nodes mat-tree-node a .node-name .node-name-item /* main items */
	,.tree-all-tasks .wrap .child-node > span:first-child /* tasks on desk e.g. https://eva.gid.team/desk/Task/SECR-18 */
	,.favorites .left-favorites__menu__item .mark-wrapper /* favorites left menu e.g. https://eva.gid.team/desk/favorites/all */
	{ /* nested tree items: level 2, 3... */
		display: list-item !important;
		list-style: circle outside !important;
		margin: 0 0 0 4px !important;
	}
	.cmf-tree .nested-nodes .node-name {
		padding-left: 12px !important;
	}

	/* wrap lines */
	.cmf-tree .overflow-ellipsis .node-name, .cmf-tree .overflow-ellipsis .node-name-item, .cmf-tree .overflow-ellipsis .node-name-item > span { /* items word-wrapping */
		line-height: 1.2;
		overflow-wrap: break-word !important;
		hyphens: auto !important;
		overflow: visible !important;
		white-space: wrap !important;
		text-wrap: pretty;
	}

	app-cmf-icon { /* always show icons of "all tasks", desks and so on (https://eva.gid.team/desk/Task/SECR-18) */
		visibility: visible !important;
	}

	/* favorites */
	.tree-all-tasks .wrap .child-node {
		height: 17px !important;
	}
	.left-menu-item {
		margin-top: 0;
		margin-bottom: 0;
	}
	.favorites .left-favorites__menu__item {
		padding-top: 0 !important;
		padding-bottom: 0 !important;
	}
	/** /Tree of docs at left **/

	/** Fix task No truncation in Task links list **/
	.item-link {
		overflow: visible;
	}

	/** Task view **/
	h1, h2, h3, h4, h5, h6, p, wg-field, .expansion-panel-header, .wrapper__right, .content__full, .mode-list, .mode-gantt, .project-module-sidenav, div.content-item /*, .form__title*/, .app-comment-form {
		margin: 0 !important;
		padding: 0 !important;
	}
	.toolbar {
		top: 7px !important;
		margin-left: 0 !important;
	}
	#ganttChartToolbarId.toolbar {
		top: 0 !important;
	}
	.mode-list, .mode-gantt {
		padding: 0 5px !important;
	}
	.gantt .header {
		height: 20px !important;
		width: fit-content;
		margin-left: 210px;
		line-height: 1.2;
	}
	.content .form { /* main task view - full screen */
		padding: 0em 0.5em 0em 1em !important;
	}
	#task-popup-dialog .content .form { /* popup task view (e.g. in tasks list, roadmap and so on ) */
		padding: 1em 10px 1em 0 !important;
	}
	.project-module-sidenav {
		height: 100%;
	}
	.crud__group__wrapper {
		border: 1px solid lightgrey;
		border-radius: 5px;
	}
	[_nghost-ng-c1144403715] .expansion-panel-header[_ngcontent-ng-c1144403715] {
		height: auto;
	}
	.expansion-panel-header {
		border: 1px solid var(--expansion-panel-border-color);
		border-radius: 20px;
	}
	.expansion-panel-header::before {
		display: none;
	}
	.expansion-panel-header .header {
		padding-left: 1em;
	}
	.expansion-panel-content {
		margin-top: -11px;
		padding: 10px 10px 0 10px !important;
		border-radius: 0 0 5px 5px !important;
	}
	wg-field:has(wg-field-title.tags) {
		display: flex;
	}
	wg-field:has(wg-field-title.tags) wg-field-title {
		margin: auto 0;
	}

	[_nghost-ng-c1721141748] .content[_ngcontent-ng-c1721141748] .form[_ngcontent-ng-c1721141748] {
		padding: 0 1em 1em 1em;
	}
	.activity-title[_ngcontent-ng-c1721141748] {
		float: left;
	}
	.activity-title[_ngcontent-ng-c1721141748] app-cmf-icon::before {
		content: ":";
		visibility: visible;
	}
	.content__left-full div:has(h2.activity-title){
		border: 1px solid var(--expansion-panel-border-color);
		margin-top: 2px;
	}
	.form__title {
		/*margin-block: 0.5em !important;*/
		margin: -8px 0 1px 0 !important;
		text-shadow: 1px 2px 5px #0745a6;
	}
	.form-header-tags {
		margin-top: -5px;
		margin-bottom: 8px;
	}

	/** Full width task page **/
	.normal-screen {
		max-width: 100%;
	}
	.body__full {
		max-width: 100%;
		padding: 0 !important;
		margin: 0;
	}
	.toolbar.full, .toolbar.full .toolbar__left-full {
		padding: 0 !important;
		margin: 0 !important;
		width: 100%;
		display: flex;
		height: 25px;
	}
	.toolbar.full {
		margin: 1px 0 7px 14px !important;
		display: contents;
	}
	/** /Full width task page **/
	/** Popup task view **/
	#task-popup-dialog .toolbar {
		margin: 0px 0px 0px 5px !important;
		padding: 0px;
		position: initial;
	}
	#task-popup-dialog .content {
		padding: 0 10px 5px 10px;
	}
	#task-popup-dialog frm-task .content .content__left {
		padding-top: 0 !important;
	}
	/** /Popup task view **/
	/** /Task view **/

	/** Task filters (lists) **/
	.feed-module {
		height: calc(100vh - 33px) !important;
	}
	/** /Task filters (lists) **/

	/** Roadmap view like https://eva.gid.team/project/Roadmap/RM-000059#rabota-komandy-po-proektu-mrg **/
	.grid-row {
		font-size: clamp(60%, 100%, 110%);
	}
	.column {
		padding: 2px !important;
	}
	.column .name {
		white-space: normal !important;
	}
	.column .node-icon { /* Group open icons */
		margin: -8px 1px 1px 1px;
	}
	.column .node-icon:has(svg[fill=none]) { /* Issue type icon */
		margin-top: -2px;
	}
	/** /Roadmap view **/

	/** Docs, requirements **/
	frm-cmf-breadcrumbs, frm-cmf-breadcrumbs .info-item {
		height: 17px !important;
		padding: 0 !important;
	}
	.toolbar .left .info {
		top: 3px;
		height: 25px;
		background: transparent;
	}
	.toolbar .left .info-item {
		padding-top: 0 !important;
		top: -5px;
		height: 25px;
	}
	.breadcrumbs.breadcrumbs-toolbar {
		border-bottom: 1px dotted;
	}
	.reference {
		height: 20px !important;
		margin-top: 0 !important;
	}
	.tools-wrapper {
		margin-top: 12px;
	}
	.document {
		padding: 30px 10px 10px 10px;
	}
	frm-cmf-req-registry h1 {
		height: 25px !important;
		line-height: 1.2;
		text-align: center;
	}
	wg-accordion-crud {
		margin: 0 !important;
	}
	.page-wrapper {
		margin: 1em !important;
	}

	/*** Docs ***/
	.document .header {
		margin-top: -4px;
	}
	/*** /Docs ***/
	/** /Docs, requirements **/
}
